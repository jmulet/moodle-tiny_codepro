define("tiny_codepro/ui",["exports","./modal","core/modal_events","./preferences"],(function(_exports,_modal,_modal_events,_preferences){var obj;
/**
   * Tiny CodePro plugin.
   *
   * @module      tiny_codepro/plugin
   * @copyright   2023 Josep Mulet Pol <pep.mulet@gmail.com>
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.handleAction=void 0,_modal_events=(obj=_modal_events)&&obj.__esModule?obj:{default:obj};let modal=null,codeEditorInstance=null;const toggleClasses=function(el,classList){const cl=el.classList;classList.forEach((className=>{cl.toggle(className)}))};_exports.handleAction=async editor=>{null===modal&&await createDialogue();modal.footer.find("button.btn[data-action]").off("click.codepro").on("click.codepro",(evt=>{if(evt.target.classList.contains("btn-primary")){const updatedCode=codeEditorInstance.getValue({source_view:!0});editor.setContent(updatedCode)}modal.hide(),codeEditorInstance.setValue()}));const markerNode=document.createElement("SPAN");markerNode.innerHTML="&nbsp;",markerNode.classList.add("CmCaReT");editor.selection.getStart().append(markerNode);let html=editor.getContent({source_view:!0});html=html.replace(/<span\s+class="CmCaReT"([^>]*)>([^<]*)<\/span>/gm,String.fromCharCode(0)),markerNode.remove(),(0,_preferences.getPref)("prettify")&&(html=codeEditorInstance.prettifyCode(html)),codeEditorInstance.setValue(html),modal.show(),setTimeout((()=>codeEditorInstance.focus()),500)};const createDialogue=async()=>{const data={elementid:Math.random().toString(32).substring(2)};return modal=await(0,_modal.createModal)({templateContext:data}),modal.getRoot().find(".modal-dialog.modal-lg").addClass("tiny_codepro-dlg"),modal.getRoot().off("keydown"),modal.getRoot().on(_modal_events.default.outsideClick,(evt=>{evt.preventDefault()})),modal.body.css("overflow-y","overlay"),modal.header.css("height","61.46px"),modal.header.css("padding","1rem 1rem"),new Promise((resolve=>{require(["tiny_codepro/cm6pro-lazy"],(CodeProEditor=>{const targetElem=modal.body.find(".tiny_codepro-editor-area")[0];codeEditorInstance=new CodeProEditor(targetElem),modal.footer.find("button.btn.btn-light").on("click",(evt=>{evt.preventDefault();const ds=evt.currentTarget.dataset,icon=evt.currentTarget.querySelector("i.fa"),$dlgElem=modal.getRoot().find('[role="document"], [data-region="modal"]');if(ds.fs)"false"===ds.fs?(ds.fs="true",modal.header.hide(),$dlgElem.removeClass("modal-dialog modal-lg modal-dialog-scrollable"),$dlgElem.addClass("tiny_codepro-fullscreen")):(ds.fs="false",modal.header.show(),$dlgElem.removeClass("tiny_codepro-fullscreen"),$dlgElem.addClass("modal-dialog modal-lg modal-dialog-scrollable")),(0,_preferences.setPref)("fs",ds.fs,!0);else if(ds.theme)"light"===ds.theme?(ds.theme="dark",codeEditorInstance.setTheme("dark"),$dlgElem.addClass("tiny_codepro-dark")):(ds.theme="light",codeEditorInstance.setTheme("light"),$dlgElem.removeClass("tiny_codepro-dark")),toggleClasses(icon,["fa-sun-o","fa-moon-o"]),(0,_preferences.setPref)("theme",ds.theme,!0);else if(ds.wrap)"true"===ds.wrap?(ds.wrap=!1,codeEditorInstance.setLineWrapping(!1)):(ds.wrap=!0,codeEditorInstance.setLineWrapping(!0)),(0,_preferences.setPref)("wrap",ds.wrap,!0),toggleClasses(icon,["fa-exchange","fa-long-arrow-right"]);else if(void 0!==ds.prettify)codeEditorInstance.prettify();else if(void 0!==ds.autoPrettify){(0,_preferences.setPref)("prettify",!(0,_preferences.getPref)("prettify",!1),!0);const icon=evt.currentTarget.querySelector("i");toggleClasses(icon,["fa-times","fa-check"])}})),modal.getRoot().on(_modal_events.default.hidden,(()=>{codeEditorInstance.setValue()}));const currentTheme=(0,_preferences.getPref)("theme","light"),currentWrap=(0,_preferences.getPref)("wrap","false"),currentFs=(0,_preferences.getPref)("fs","false"),currentPrettify=(0,_preferences.getPref)("prettify",!1);"light"!==currentTheme&&modal.footer.find("button.btn.btn-light[data-theme]").click(),"true"===currentWrap&&modal.footer.find("button.btn.btn-light[data-wrap]").click(),"true"===currentFs&&modal.footer.find("button.btn.btn-light[data-fs]").click(),currentPrettify&&modal.footer.find("button.btn.btn-light[data-auto-prettify] > i").removeClass("fa-times").addClass("fa-check"),resolve(modal)}))}))}}));

//# sourceMappingURL=ui.min.js.map