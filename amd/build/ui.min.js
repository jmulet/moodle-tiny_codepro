define("tiny_codepro/ui",["exports","./modal","core/modal_factory","core/modal_events","./common","./preferences"],(function(_exports,_modal,_modal_factory,_modal_events,_common,_preferences){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Tiny CodePro plugin.
   *
   * @module      tiny_codepro/plugin
   * @copyright   2023 Josep Mulet Pol <pep.mulet@gmail.com>
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.handleAction=void 0,_modal=_interopRequireDefault(_modal),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events);let modal=null,codeEditorInstance=null;const toggleClasses=function(el,classList){const cl=el.classList;classList.forEach((className=>{cl.toggle(className)}))};_exports.handleAction=editor=>{null===modal?createDialogue(editor):(modal.show(),codeEditorInstance.setValue(editor.getContent()))};const createDialogue=async editor=>{const data={elementid:editor.id};modal=await _modal_factory.default.create({type:_modal.default.TYPE,templateContext:data,large:!0}),modal.getRoot().find(".modal-dialog.modal-lg").css("max-width","85%"),modal.getRoot().off("keydown"),modal.body.css("overflow-y","overlay"),require.config({paths:{cm6pro:_common.baseUrl+"/libs/codemirror/dist/cm6pro.min"}}),require(["cm6pro"],(CodeProEditor=>{const targetElem=modal.body.find(".tiny_codepro-editor-area")[0];codeEditorInstance=new CodeProEditor(targetElem),modal.footer.find("button.btn[data-action]").on("click",(evt=>{if(evt.target.classList.contains("btn-primary")){const updatedCode=codeEditorInstance.getValue();editor.setContent(updatedCode)}modal.hide(),codeEditorInstance.setValue()})),modal.footer.find("button.btn.btn-light").on("click",(evt=>{evt.preventDefault();const ds=evt.currentTarget.dataset,icon=evt.currentTarget.querySelector("i.fa");ds.fs?("false"===ds.fs?(ds.fs="true",modal.header.hide(),modal.getRoot().find('[role="document"]').removeClass("modal-dialog modal-lg modal-dialog-scrollable"),modal.getRoot().find('[role="document"]').addClass("tiny_codepro-fullscreen")):(ds.fs="false",modal.header.show(),modal.getRoot().find('[role="document"]').removeClass("tiny_codepro-fullscreen"),modal.getRoot().find('[role="document"]').addClass("modal-dialog modal-lg modal-dialog-scrollable")),(0,_preferences.setPref)("fs",ds.fs,!0)):ds.theme?("light"===ds.theme?(ds.theme="dark",codeEditorInstance.setTheme("dark"),modal.getRoot().find('[role="document"]').addClass("tiny_codepro-dark")):(ds.theme="light",codeEditorInstance.setTheme("light"),modal.getRoot().find('[role="document"]').removeClass("tiny_codepro-dark")),toggleClasses(icon,["fa-sun-o","fa-moon-o"]),(0,_preferences.setPref)("theme",ds.theme,!0)):ds.wrap?("true"===ds.wrap?(ds.wrap=!1,codeEditorInstance.setLineWrapping(!1)):(ds.wrap=!0,codeEditorInstance.setLineWrapping(!0)),(0,_preferences.setPref)("wrap",ds.wrap,!0),toggleClasses(icon,["fa-exchange","fa-long-arrow-right"])):ds.prettify&&codeEditorInstance.prettify()})),modal.getRoot().on(_modal_events.default.hidden,(()=>{codeEditorInstance.setValue()}));const currentTheme=(0,_preferences.getPref)("theme","light"),currentWrap=(0,_preferences.getPref)("wrap","false"),currentFs=(0,_preferences.getPref)("fs","false");"light"!==currentTheme&&modal.footer.find("button.btn.btn-light[data-theme]").click(),"true"===currentWrap&&modal.footer.find("button.btn.btn-light[data-wrap]").click(),"true"===currentFs&&modal.footer.find("button.btn.btn-light[data-fs]").click(),modal.show(),codeEditorInstance.setValue(editor.getContent())}))}}));

//# sourceMappingURL=ui.min.js.map