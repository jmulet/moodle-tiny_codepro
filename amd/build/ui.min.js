define("tiny_codepro/ui",["exports","./modal","core/modal_events","./preferences"],(function(_exports,_modal,_modal_events,_preferences){var obj;
/**
   * Tiny CodePro plugin.
   *
   * @module      tiny_codepro/plugin
   * @copyright   2023 Josep Mulet Pol <pep.mulet@gmail.com>
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.requireCm6Pro=_exports.handleAction=void 0,_modal_events=(obj=_modal_events)&&obj.__esModule?obj:{default:obj};let modal=null,codeEditorInstance=null;const toggleClasses=function(el,classList){const cl=el.classList;classList.forEach((className=>{cl.toggle(className)}))};let isLoading=!1;_exports.handleAction=async(editor,initialHTML)=>{var _codeEditorInstance4;if(isLoading)return;null===modal&&(isLoading=!0,modal=await createDialogue(editor),isLoading=!1);let html;if(modal.footer.find("button.btn[data-action]").off("click.codepro").on("click.codepro",(evt=>{var _codeEditorInstance2;if(evt.target.classList.contains("btn-primary")){var _codeEditorInstance;const updatedCode=null===(_codeEditorInstance=codeEditorInstance)||void 0===_codeEditorInstance?void 0:_codeEditorInstance.getValue({source_view:!0});editor.setContent(updatedCode??"")}modal.hide(),null===(_codeEditorInstance2=codeEditorInstance)||void 0===_codeEditorInstance2||_codeEditorInstance2.setValue()})),initialHTML)html=initialHTML;else{const markerNode=document.createElement("SPAN");markerNode.innerHTML="&nbsp;",markerNode.classList.add("CmCaReT");var _codeEditorInstance3;if(editor.selection.getStart().append(markerNode),html=editor.getContent({source_view:!0}),html=html.replace(/<span\s+class="CmCaReT"([^>]*)>([^<]*)<\/span>/gm,String.fromCharCode(0)),markerNode.remove(),(0,_preferences.getPref)("prettify"))html=null===(_codeEditorInstance3=codeEditorInstance)||void 0===_codeEditorInstance3?void 0:_codeEditorInstance3.prettifyCode(html)}null===(_codeEditorInstance4=codeEditorInstance)||void 0===_codeEditorInstance4||_codeEditorInstance4.setValue(html),modal.show(),setTimeout((()=>{var _codeEditorInstance5;return null===(_codeEditorInstance5=codeEditorInstance)||void 0===_codeEditorInstance5?void 0:_codeEditorInstance5.focus()}),500)};const requireCm6Pro=()=>new Promise((resolve=>{require(["tiny_codepro/cm6pro-lazy"],(CodeProEditor=>{resolve(CodeProEditor)}))}));_exports.requireCm6Pro=requireCm6Pro;const createDialogue=async editor=>{const data={elementid:Math.random().toString(32).substring(2)},modal=await(0,_modal.createModal)({templateContext:data});modal.getRoot().find(".modal-dialog.modal-lg").addClass("tiny_codepro-dlg"),modal.getRoot().off("keydown"),modal.getRoot().on(_modal_events.default.outsideClick,(evt=>{evt.preventDefault()})),modal.body.css("overflow-y","overlay"),modal.header.css("height","61.46px"),modal.header.css("padding","1rem 1rem");const CodeProEditor=await requireCm6Pro(),targetElem=modal.body.find(".tiny_codepro-editor-area")[0];codeEditorInstance=new CodeProEditor(targetElem),modal.footer.find("button.btn.btn-light").on("click",(evt=>{evt.preventDefault();const ds=evt.currentTarget.dataset,icon=evt.currentTarget.querySelector("i.fa"),$dlgElem=modal.getRoot().find('[role="document"], [data-region="modal"]');if(ds.fs)"false"===ds.fs?(ds.fs="true",modal.header.hide(),$dlgElem.removeClass("modal-dialog modal-lg modal-dialog-scrollable"),$dlgElem.addClass("tiny_codepro-fullscreen")):(ds.fs="false",modal.header.show(),$dlgElem.removeClass("tiny_codepro-fullscreen"),$dlgElem.addClass("modal-dialog modal-lg modal-dialog-scrollable")),(0,_preferences.setPref)("fs",ds.fs,!0);else if(ds.theme)"light"===ds.theme?(ds.theme="dark",codeEditorInstance.setTheme("dark"),$dlgElem.addClass("tiny_codepro-dark")):(ds.theme="light",codeEditorInstance.setTheme("light"),$dlgElem.removeClass("tiny_codepro-dark")),toggleClasses(icon,["fa-sun-o","fa-moon-o"]),(0,_preferences.setPref)("theme",ds.theme,!0);else if(ds.wrap){var _codeEditorInstance6,_codeEditorInstance7;if("true"===ds.wrap)ds.wrap=!1,null===(_codeEditorInstance6=codeEditorInstance)||void 0===_codeEditorInstance6||_codeEditorInstance6.setLineWrapping(!1);else ds.wrap=!0,null===(_codeEditorInstance7=codeEditorInstance)||void 0===_codeEditorInstance7||_codeEditorInstance7.setLineWrapping(!0);(0,_preferences.setPref)("wrap",ds.wrap,!0),toggleClasses(icon,["fa-exchange","fa-long-arrow-right"])}else if(void 0!==ds.prettify){var _codeEditorInstance8;null===(_codeEditorInstance8=codeEditorInstance)||void 0===_codeEditorInstance8||_codeEditorInstance8.prettify()}else if(void 0!==ds.view){const initialHTML=codeEditorInstance.getValue();console.log(initialHTML),modal.hide(),editor.execCommand("ToggleView",!1,"codepro")}})),modal.getRoot().on(_modal_events.default.hidden,(()=>{var _codeEditorInstance9;null===(_codeEditorInstance9=codeEditorInstance)||void 0===_codeEditorInstance9||_codeEditorInstance9.setValue()}));const currentTheme=(0,_preferences.getPref)("theme","light"),currentWrap=(0,_preferences.getPref)("wrap","false"),currentFs=(0,_preferences.getPref)("fs","false");return"light"!==currentTheme&&modal.footer.find("button.btn.btn-light[data-theme]").click(),"true"===currentWrap&&modal.footer.find("button.btn.btn-light[data-wrap]").click(),"true"===currentFs&&modal.footer.find("button.btn.btn-light[data-fs]").click(),modal}}));

//# sourceMappingURL=ui.min.js.map