{"version":3,"file":"viewdialog.min.js","sources":["../src/viewdialog.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\nimport {createModal} from \"./modal\";\nimport ModalEvents from 'core/modal_events';\nimport {getPref, setPref} from \"./preferences\";\nimport {getDefaultUI} from \"./options\";\nimport {ViewManager} from \"./viewmanager\";\n\n/**\n * Tiny CodePro plugin.\n *\n * @module      tiny_codepro/plugin\n * @copyright   2023-2025 Josep Mulet Pol <pep.mulet@gmail.com>\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nconst dialogQuery = '[role=\"document\"], [data-region=\"modal\"]';\n\nexport class ViewDialogManager extends ViewManager {\n    constructor(editor, opts) {\n        super(editor, opts);\n    }\n    async _tShow() {\n        // Add the codeEditor (CodeMirror) in the selected UI element\n        await this.attachCodeEditor(this.codeEditorElement);\n        // Obtain the code from Tiny and set it to code editor\n        this.setHTMLCodeOrState();\n        // Make the modal visible\n        this.modal.show();\n    }\n\n    async _tCreate() {\n        const defaultUI = getDefaultUI(this.editor) ?? 'dialog';\n        const canUserSwitchUI = defaultUI.startsWith('user:');\n\n        const data = {\n            elementid: Math.random().toString(32).substring(2),\n            canUserSwitchUI,\n            icons: ViewManager.icons\n        };\n\n        // Show modal with buttons.\n        const modal = await createModal({\n            templateContext: data,\n        });\n        this.modal = modal;\n\n        this.codeEditorElement = modal.body.find('.tiny_codepro-editor-area')[0];\n\n        modal.getRoot().find(\".modal-dialog.modal-lg\").addClass(\"tiny_codepro-dlg\");\n        // Disable keyboard events (ESC key) on this modal\n        modal.getRoot().off('keydown');\n        // Prevent modal from closing on outside clicks\n        modal.getRoot().on(ModalEvents.outsideClick, (evt) => {\n            evt.preventDefault();\n        });\n        modal.body.css(\"overflow-y\", \"overlay\");\n        // Override styles imposed by body.tox-fullscreen on modals\n        modal.header.css('height', '61.46px');\n        modal.header.css('padding', '1rem 1rem');\n\n        this.#bindActions();\n    }\n\n    #bindActions() {\n        this.modal.footer.find(\"button.btn[data-action]\").on(\"click\", (evt) => {\n            const actionName = evt.target.dataset.action;\n            switch (actionName) {\n                case (\"view\"):\n                    this.switchViews();\n                    break;\n                case (\"fs\"):\n                    this.#toggleFullscreen();\n                    break;\n                case (\"font-\"):\n                    this.decreaseFontsize();\n                    break;\n                case (\"font+\"):\n                    this.increaseFontsize();\n                    break;\n                case (\"theme\"):\n                    this.toggleTheme();\n                    break;\n                case (\"wrap\"):\n                    this.toggleLineWrapping();\n                    break;\n                case (\"prettify\"):\n                    this.prettify();\n                    break;\n                case (\"cancel\"):\n                    this.close();\n                    break;\n                case (\"save\"):\n                    this.accept();\n                    break;\n            }\n        });\n    }\n\n    #toggleFullscreen() {\n        const $dlgElem = this.modal.getRoot().find(dialogQuery);\n        const isFullscreen = getPref(\"fs\", false);\n        if (!isFullscreen) {\n            // Set fullscreen mode\n            this.modal.header.hide();\n            $dlgElem.removeClass(\"modal-dialog modal-lg modal-dialog-scrollable\");\n            $dlgElem.addClass(\"tiny_codepro-fullscreen\");\n        } else {\n            // Set to modal-lg\n            this.modal.header.show();\n            $dlgElem.removeClass(\"tiny_codepro-fullscreen\");\n            $dlgElem.addClass(\"modal-dialog modal-lg modal-dialog-scrollable\");\n        }\n        setPref(\"fs\", !isFullscreen, true);\n    }\n\n    #unbindActions() {\n        this.modal.footer.find(\"button.btn[data-action]\").off(\"click\");\n    }\n\n    _tClose() {\n        this.#unbindActions();\n        this.modal.destroy();\n    }\n}\n"],"names":["ViewDialogManager","ViewManager","constructor","editor","opts","this","attachCodeEditor","codeEditorElement","setHTMLCodeOrState","modal","show","canUserSwitchUI","startsWith","data","elementid","Math","random","toString","substring","icons","templateContext","body","find","getRoot","addClass","off","on","ModalEvents","outsideClick","evt","preventDefault","css","header","bindActions","footer","target","dataset","action","switchViews","toggleFullscreen","decreaseFontsize","increaseFontsize","toggleTheme","toggleLineWrapping","prettify","close","accept","$dlgElem","isFullscreen","removeClass","hide","_tClose","unbindActions","destroy"],"mappings":";;;;;;;yKA8BaA,0BAA0BC,yBACnCC,YAAYC,OAAQC,YACVD,OAAQC,2BAIRC,KAAKC,iBAAiBD,KAAKE,wBAE5BC,0BAEAC,MAAMC,8BAKLC,kBADY,yBAAaN,KAAKF,SAAW,UACbS,WAAW,SAEvCC,KAAO,CACTC,UAAWC,KAAKC,SAASC,SAAS,IAAIC,UAAU,GAChDP,gBAAAA,gBACAQ,MAAOlB,yBAAYkB,OAIjBV,YAAc,sBAAY,CAC5BW,gBAAiBP,YAEhBJ,MAAQA,WAERF,kBAAoBE,MAAMY,KAAKC,KAAK,6BAA6B,GAEtEb,MAAMc,UAAUD,KAAK,0BAA0BE,SAAS,oBAExDf,MAAMc,UAAUE,IAAI,WAEpBhB,MAAMc,UAAUG,GAAGC,sBAAYC,cAAeC,MAC1CA,IAAIC,oBAERrB,MAAMY,KAAKU,IAAI,aAAc,WAE7BtB,MAAMuB,OAAOD,IAAI,SAAU,WAC3BtB,MAAMuB,OAAOD,IAAI,UAAW,mBAEvBE,kCAIAxB,MAAMyB,OAAOZ,KAAK,2BAA2BI,GAAG,SAAUG,aACxCA,IAAIM,OAAOC,QAAQC,YAE5B,YACGC,wBAEH,WACGC,6BAEH,aACGC,6BAEH,aACGC,6BAEH,aACGC,wBAEH,YACGC,+BAEH,gBACGC,qBAEH,cACGC,kBAEH,YACGC,uCAOXC,SAAW1C,KAAKI,MAAMc,UAAUD,KApF1B,4CAqFN0B,cAAe,wBAAQ,MAAM,GAC9BA,mBAOIvC,MAAMuB,OAAOtB,OAClBqC,SAASE,YAAY,2BACrBF,SAASvB,SAAS,wDAPbf,MAAMuB,OAAOkB,OAClBH,SAASE,YAAY,iDACrBF,SAASvB,SAAS,qDAOd,MAAOwB,cAAc,yBAIxBvC,MAAMyB,OAAOZ,KAAK,2BAA2BG,IAAI,SAG1D0B,gBACSC,qBACA3C,MAAM4C"}